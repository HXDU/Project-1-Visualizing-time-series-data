<!DOCTYPE html>
<html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8"><meta charset="utf-8">
<style> /* set the CSS */
path{
  stroke-width: 1;
}
.line {
  fill: none;
  stroke: steelblue;
  stroke-width: 2px;
}

.line--fade {
  opacity: 0.5;
}

.line--hover {
  stroke-width: 3px;
  opacity: 1.0;
}

.axisSteelBlue text{
  fill: #4B999F;
  opacity: 1.5;
  font-size: 12px;
}
.axisOrange text{
  fill: #D2691E;
  opacity: 1.5;
  font-size: 12px;
}

.axisRegular text{
  opacity: 1.5;
  font-size: 12px;
}

.tooltip{
  position: absolute;
  opacity: 0;

}

</style>

</head><body id="total_wildfire">
  <table>
    <!--The first row: only one big graph-->
    <tbody><tr>
      <td style="vertical-align: top;">
        <svg id="unknown" width="300" height="500" position="absolute"></svg>
        <svg width="960" height="500" id="total_over_time" style="position: absolute;"><g transform="translate(100,30)"><text style="font-size: 20px;" transform="translate(270, 0 )">CA Wildfire Tweets: Year 2018</text><path class="line" style="stroke: rgb(75, 153, 159);" d="M0,58.99449500000003L36.81818181818182,82.95065500000004L73.63636363636364,97.73556000000002L110.45454545454545,37.14232499999997L147.27272727272728,67.502905L184.0909090909091,88.216005L220.9090909090909,80.22918500000003L257.72727272727275,27.408844999999985L294.54545454545456,99.17347999999998L331.3636363636364,106.11927000000003L368.1818181818182,102.38256999999999L405,78.86931000000004L441.8181818181818,100.953465L478.6363636363637,74.09028999999998L515.4545454545455,72.68526500000002L552.2727272727273,86.64650499999999L589.0909090909091,94.66793999999999L625.9090909090909,95.65651000000003L662.7272727272727,73.84519L699.5454545454545,65.40687000000003L736.3636363636364,90.39159000000001L773.1818181818182,69.96099999999996L810,87.337085"></path><path class="line" style="stroke: rgb(210, 105, 30);" d="M0,364.468L36.81818181818182,281.56399999999996L73.63636363636364,266.772L110.45454545454545,324.22L147.27272727272728,315.706L184.0909090909091,344.946L220.9090909090909,355.438L257.72727272727275,356.556L294.54545454545456,361.286L331.3636363636364,357.76L368.1818181818182,377.626L405,385.882L441.8181818181818,402.824L478.6363636363637,389.408L515.4545454545455,417.874L552.2727272727273,417.1L589.0909090909091,419.508L625.9090909090909,414.778L662.7272727272727,417.014L699.5454545454545,410.994L736.3636363636364,414.864L773.1818181818182,410.65L810,418.992"></path><g transform="translate(0,430)" fill="none" font-size="10" font-family="sans-serif" text-anchor="middle" style="opacity: 0.8;"><path class="domain" stroke="#000" d="M0.5,6V0.5H810.5V6"></path><g class="tick" opacity="1" transform="translate(0.5,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">11-08</text></g><g class="tick" opacity="1" transform="translate(37.31818181818182,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">11-09</text></g><g class="tick" opacity="1" transform="translate(74.13636363636364,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">11-10</text></g><g class="tick" opacity="1" transform="translate(110.95454545454545,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">11-11</text></g><g class="tick" opacity="1" transform="translate(147.77272727272728,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">11-12</text></g><g class="tick" opacity="1" transform="translate(184.5909090909091,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">11-13</text></g><g class="tick" opacity="1" transform="translate(221.4090909090909,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">11-14</text></g><g class="tick" opacity="1" transform="translate(258.22727272727275,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">11-15</text></g><g class="tick" opacity="1" transform="translate(295.04545454545456,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">11-16</text></g><g class="tick" opacity="1" transform="translate(331.8636363636364,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">11-17</text></g><g class="tick" opacity="1" transform="translate(368.6818181818182,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">11-18</text></g><g class="tick" opacity="1" transform="translate(405.5,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">11-19</text></g><g class="tick" opacity="1" transform="translate(442.3181818181818,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">11-20</text></g><g class="tick" opacity="1" transform="translate(479.1363636363637,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">11-21</text></g><g class="tick" opacity="1" transform="translate(515.9545454545455,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">11-22</text></g><g class="tick" opacity="1" transform="translate(552.7727272727273,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">11-23</text></g><g class="tick" opacity="1" transform="translate(589.5909090909091,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">11-24</text></g><g class="tick" opacity="1" transform="translate(626.4090909090909,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">11-25</text></g><g class="tick" opacity="1" transform="translate(663.2272727272727,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">11-26</text></g><g class="tick" opacity="1" transform="translate(700.0454545454545,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">11-27</text></g><g class="tick" opacity="1" transform="translate(736.8636363636364,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">11-28</text></g><g class="tick" opacity="1" transform="translate(773.6818181818182,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">11-29</text></g><g class="tick" opacity="1" transform="translate(810.5,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">11-30</text></g></g><g class="axisSteelBlue" fill="none" font-size="10" font-family="sans-serif" text-anchor="end"><path class="domain" stroke="#000" d="M-6,430.5H0.5V0.5H-6"></path><g class="tick" opacity="1" transform="translate(0,430.5)"><line stroke="#000" x2="-6"></line><text fill="#000" x="-9" dy="0.32em">0</text></g><g class="tick" opacity="1" transform="translate(0,387.5)"><line stroke="#000" x2="-6"></line><text fill="#000" x="-9" dy="0.32em">200,000</text></g><g class="tick" opacity="1" transform="translate(0,344.5)"><line stroke="#000" x2="-6"></line><text fill="#000" x="-9" dy="0.32em">400,000</text></g><g class="tick" opacity="1" transform="translate(0,301.5)"><line stroke="#000" x2="-6"></line><text fill="#000" x="-9" dy="0.32em">600,000</text></g><g class="tick" opacity="1" transform="translate(0,258.5)"><line stroke="#000" x2="-6"></line><text fill="#000" x="-9" dy="0.32em">800,000</text></g><g class="tick" opacity="1" transform="translate(0,215.5)"><line stroke="#000" x2="-6"></line><text fill="#000" x="-9" dy="0.32em">1,000,000</text></g><g class="tick" opacity="1" transform="translate(0,172.5)"><line stroke="#000" x2="-6"></line><text fill="#000" x="-9" dy="0.32em">1,200,000</text></g><g class="tick" opacity="1" transform="translate(0,129.5)"><line stroke="#000" x2="-6"></line><text fill="#000" x="-9" dy="0.32em">1,400,000</text></g><g class="tick" opacity="1" transform="translate(0,86.5)"><line stroke="#000" x2="-6"></line><text fill="#000" x="-9" dy="0.32em">1,600,000</text></g><g class="tick" opacity="1" transform="translate(0,43.5)"><line stroke="#000" x2="-6"></line><text fill="#000" x="-9" dy="0.32em">1,800,000</text></g><g class="tick" opacity="1" transform="translate(0,0.5)"><line stroke="#000" x2="-6"></line><text fill="#000" x="-9" dy="0.32em">2,000,000</text></g><text style="font-size: 12px; text-anchor: start;">Total Tweets collected</text></g><g class="axisOrange" transform="translate( 810, 0 )" fill="none" font-size="10" font-family="sans-serif" text-anchor="start"><path class="domain" stroke="#000" d="M6,430.5H0.5V0.5H6"></path><g class="tick" opacity="1" transform="translate(0,430.5)"><line stroke="#000" x2="6"></line><text fill="#000" x="9" dy="0.32em">0</text></g><g class="tick" opacity="1" transform="translate(0,387.5)"><line stroke="#000" x2="6"></line><text fill="#000" x="9" dy="0.32em">500</text></g><g class="tick" opacity="1" transform="translate(0,344.5)"><line stroke="#000" x2="6"></line><text fill="#000" x="9" dy="0.32em">1,000</text></g><g class="tick" opacity="1" transform="translate(0,301.5)"><line stroke="#000" x2="6"></line><text fill="#000" x="9" dy="0.32em">1,500</text></g><g class="tick" opacity="1" transform="translate(0,258.5)"><line stroke="#000" x2="6"></line><text fill="#000" x="9" dy="0.32em">2,000</text></g><g class="tick" opacity="1" transform="translate(0,215.5)"><line stroke="#000" x2="6"></line><text fill="#000" x="9" dy="0.32em">2,500</text></g><g class="tick" opacity="1" transform="translate(0,172.5)"><line stroke="#000" x2="6"></line><text fill="#000" x="9" dy="0.32em">3,000</text></g><g class="tick" opacity="1" transform="translate(0,129.5)"><line stroke="#000" x2="6"></line><text fill="#000" x="9" dy="0.32em">3,500</text></g><g class="tick" opacity="1" transform="translate(0,86.5)"><line stroke="#000" x2="6"></line><text fill="#000" x="9" dy="0.32em">4,000</text></g><g class="tick" opacity="1" transform="translate(0,43.5)"><line stroke="#000" x2="6"></line><text fill="#000" x="9" dy="0.32em">4,500</text></g><g class="tick" opacity="1" transform="translate(0,0.5)"><line stroke="#000" x2="6"></line><text fill="#000" x="9" dy="0.32em">5,000</text></g><text style="font-size: 12px; text-anchor: end;">CA wildfire tweets</text></g></g></svg>
      </td>
    </tr>

    <tr>
      <td style="vertical-align: top;">
        <div id="topic_options" width="150" height="150" position="absolute"><select><option value="Choose" selected="selected">Choose</option><option value="Topic 1">Topic 1</option><option value="Topic 2">Topic 2</option><option value="Topic 3">Topic 3</option><option value="Topic 4">Topic 4</option><option value="Topic 5">Topic 5</option><option value="Topic 6">Topic 6</option><option value="Topic 7">Topic 7</option><option value="Topic 8">Topic 8</option><option value="Topic 9">Topic 9</option><option value="Topic 10">Topic 10</option></select><text><br></text><text style="font-size: 15px;">*Top 10 Topics Generated by LDA Topic Modeling</text></div>
        <div id="theTopicText" position="absolute"></div>
      </td>

      <td style="vertical-align: top;">
        <!--button onclick="update(loc)" style = "vertical-align: top;">Locations</button>
        <button onclick="update(cot)" style = "vertical-align: top;">Contents</button-->
        <svg width="1000" height="600" id="graph2"><svg width="900" height="500" style="position: absolute;" transform="translate(50,20)"><g transform="translate(50,20)"><g transform="translate(0,450)" fill="none" font-size="10" font-family="sans-serif" text-anchor="middle" style="opacity: 0.8;"><path class="domain" stroke="#000" d="M0.5,6V0.5H820.5V6"></path><g class="tick" opacity="1" transform="translate(0.5,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">11-08</text></g><g class="tick" opacity="1" transform="translate(37.77272727272727,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">11-09</text></g><g class="tick" opacity="1" transform="translate(75.04545454545455,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">11-10</text></g><g class="tick" opacity="1" transform="translate(112.31818181818181,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">11-11</text></g><g class="tick" opacity="1" transform="translate(149.5909090909091,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">11-12</text></g><g class="tick" opacity="1" transform="translate(186.86363636363635,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">11-13</text></g><g class="tick" opacity="1" transform="translate(224.13636363636363,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">11-14</text></g><g class="tick" opacity="1" transform="translate(261.4090909090909,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">11-15</text></g><g class="tick" opacity="1" transform="translate(298.6818181818182,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">11-16</text></g><g class="tick" opacity="1" transform="translate(335.9545454545455,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">11-17</text></g><g class="tick" opacity="1" transform="translate(373.2272727272727,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">11-18</text></g><g class="tick" opacity="1" transform="translate(410.5,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">11-19</text></g><g class="tick" opacity="1" transform="translate(447.77272727272725,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">11-20</text></g><g class="tick" opacity="1" transform="translate(485.04545454545456,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">11-21</text></g><g class="tick" opacity="1" transform="translate(522.3181818181818,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">11-22</text></g><g class="tick" opacity="1" transform="translate(559.590909090909,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">11-23</text></g><g class="tick" opacity="1" transform="translate(596.8636363636364,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">11-24</text></g><g class="tick" opacity="1" transform="translate(634.1363636363636,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">11-25</text></g><g class="tick" opacity="1" transform="translate(671.409090909091,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">11-26</text></g><g class="tick" opacity="1" transform="translate(708.6818181818182,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">11-27</text></g><g class="tick" opacity="1" transform="translate(745.9545454545454,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">11-28</text></g><g class="tick" opacity="1" transform="translate(783.2272727272727,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">11-29</text></g><g class="tick" opacity="1" transform="translate(820.5,0)"><line stroke="#000" y2="6"></line><text fill="#000" y="9" dy="0.71em">11-30</text></g></g><g class="axisRegular" fill="none" font-size="10" font-family="sans-serif" text-anchor="end"><path class="domain" stroke="#000" d="M-6,450.5H0.5V0.5H-6"></path><g class="tick" opacity="1" transform="translate(0,450.5)"><line stroke="#000" x2="-6"></line><text fill="#000" x="-9" dy="0.32em">0</text></g><g class="tick" opacity="1" transform="translate(0,405.5)"><line stroke="#000" x2="-6"></line><text fill="#000" x="-9" dy="0.32em">200</text></g><g class="tick" opacity="1" transform="translate(0,360.5)"><line stroke="#000" x2="-6"></line><text fill="#000" x="-9" dy="0.32em">400</text></g><g class="tick" opacity="1" transform="translate(0,315.5)"><line stroke="#000" x2="-6"></line><text fill="#000" x="-9" dy="0.32em">600</text></g><g class="tick" opacity="1" transform="translate(0,270.5)"><line stroke="#000" x2="-6"></line><text fill="#000" x="-9" dy="0.32em">800</text></g><g class="tick" opacity="1" transform="translate(0,225.5)"><line stroke="#000" x2="-6"></line><text fill="#000" x="-9" dy="0.32em">1,000</text></g><g class="tick" opacity="1" transform="translate(0,180.5)"><line stroke="#000" x2="-6"></line><text fill="#000" x="-9" dy="0.32em">1,200</text></g><g class="tick" opacity="1" transform="translate(0,135.5)"><line stroke="#000" x2="-6"></line><text fill="#000" x="-9" dy="0.32em">1,400</text></g><g class="tick" opacity="1" transform="translate(0,90.5)"><line stroke="#000" x2="-6"></line><text fill="#000" x="-9" dy="0.32em">1,600</text></g><g class="tick" opacity="1" transform="translate(0,45.5)"><line stroke="#000" x2="-6"></line><text fill="#000" x="-9" dy="0.32em">1,800</text></g><g class="tick" opacity="1" transform="translate(0,0.5)"><line stroke="#000" x2="-6"></line><text fill="#000" x="-9" dy="0.32em">2,000</text></g></g><rect height="5" width="25" fill="green" transform="translate(25,0)"></rect><text style="font-size: 13px;" transform="translate(50,3)">CA Wildfire Tweets</text><rect height="5" width="25" fill="red" transform="translate(200,0)"></rect><text style="font-size: 13px;" transform="translate(225,3)">Those Located in CA</text><rect height="5" width="25" fill="purple" transform="translate(400,0)"></rect><text style="font-size: 13px;" transform="translate(425,3)">Other than CA</text><rect height="5" width="25" fill="#4B999F" transform="translate(200,20)"></rect><text style="font-size: 13px;" transform="translate(225,23)">Those are Rescue-related</text><path class="line res" style="stroke: rgb(75, 153, 159); opacity: 0;" d="M0,426.15L36.81818181818182,398.7L73.63636363636364,404.325L110.45454545454545,398.25L147.27272727272728,394.425L184.0909090909091,423.225L220.9090909090909,426.6L257.72727272727275,431.1L294.54545454545456,432.675L331.3636363636364,433.35L368.1818181818182,436.725L405,440.325L441.8181818181818,442.8L478.6363636363637,435.15L515.4545454545455,445.95L552.2727272727273,445.5L589.0909090909091,447.525L625.9090909090909,444.375L662.7272727272727,445.95L699.5454545454545,441.225L736.3636363636364,447.3L773.1818181818182,445.5L810,444.15"></path><path class="line otherLoc" style="stroke: purple; opacity: 0;" d="M0,394.2L36.81818181818182,291.375L73.63636363636364,249.975L110.45454545454545,319.725L147.27272727272728,294.75L184.0909090909091,334.125L220.9090909090909,360.9L257.72727272727275,377.325L294.54545454545456,388.35L331.3636363636364,364.275L368.1818181818182,378.225L405,386.325L441.8181818181818,411.075L478.6363636363637,398.475L515.4545454545455,431.55L552.2727272727273,434.475L589.0909090909091,434.475L625.9090909090909,427.05L662.7272727272727,428.175L699.5454545454545,421.2L736.3636363636364,424.575L773.1818181818182,427.725L810,429.075"></path><path class="line CAbased" style="stroke: red; opacity: 0;" d="M0,334.35L36.81818181818182,220.27500000000003L73.63636363636364,222.97500000000002L110.45454545454545,303.525L147.27272727272728,306.225L184.0909090909091,343.35L220.9090909090909,344.025L257.72727272727275,330.525L294.54545454545456,331.875L331.3636363636364,346.725L368.1818181818182,384.75L405,398.25L441.8181818181818,417.825L478.6363636363637,395.325L515.4545454545455,436.725L552.2727272727273,431.775L589.0909090909091,438.075L625.9090909090909,433.125L662.7272727272727,437.85L699.5454545454545,429.075L736.3636363636364,435.825L773.1818181818182,421.65L810,442.125"></path><path class="line wildfire" style="stroke: green; opacity: 0;" d="M0,278.55L36.81818181818182,61.64999999999998L73.63636363636364,22.950000000000045L110.45454545454545,173.25L147.27272727272728,150.97500000000002L184.0909090909091,227.475L220.9090909090909,254.925L257.72727272727275,257.85L294.54545454545456,270.225L331.3636363636364,261L368.1818181818182,312.975L405,334.575L441.8181818181818,378.9L478.6363636363637,343.8L515.4545454545455,418.275L552.2727272727273,416.25L589.0909090909091,422.55L625.9090909090909,410.175L662.7272727272727,416.025L699.5454545454545,400.275L736.3636363636364,410.4L773.1818181818182,399.375L810,421.2"></path></g></svg></svg>
        <div id="tool"></div>
      </td>
    </tr>

  </tbody></table>

<!-- load the d3.js library -->
<script src="project1_files/d3.js"></script>

<script>

//Step 1: draw the topic dropdownButton part
//topic options
var topics = [
    ["air","smoke","area","quality","due"],
    ["wildfire","safe","survivor","stay","hope"],
    ["county","butte","million","san","reveal"],
    ["death","update","acres","contain","paradise"],
    ["wildfire","california","affect","home","lost"],
    ["great","first","blame","time","get"],
    ["new","donate","thank","place","favorite"],
    ["wildfire","california","fire","cause","camp"],
    ["help","victim","please","need","support"],
    ["california","wildfire","trump","via","deadly"]
];

var options = ["Choose","Topic 1", "Topic 2", "Topic 3", "Topic 4", "Topic 5", "Topic 6", "Topic 7", "Topic 8", "Topic 9", "Topic 10"];

var dropdownButton = d3.select("#topic_options")
                        .append('select');

dropdownButton.selectAll('myOptions')
              .data(options)
              .enter()
              .append('option')
              .text(function(d){return d;})
              .attr("value", function(d){return d;});

var show_topic = d3.select("#theTopicText");

function showTopic(index){
   show_topic.append("text")
          .text("Topic "+ (index + 1) + ":" + topics[index]).append("br")
          .style("font-size","13px");
}
//when the button is chosen, it will show the coorespond topics.
//click the choose button, all the output will be cleared
dropdownButton.on("change", function(d){
  var selectedOption = d3.select(this).property("value");
  var temp = selectedOption.split(' ');
  var index = temp[1];
  //If choose was taken
  if(isNaN(index)){
     //js way to clear
     // document.getElementById('theTopicText').innerHTML = "";
     //d3 way to clear
     show_topic.html("");
     console.log("hello");
  }
  else{
    showTopic(index - 1);
  }
})

//Add titles for the button
var title = d3.select("#topic_options");
//An empty line after the button
title.append("text")
     .text("")
     .append("br");

title.append("text")
          .text("*Top 10 Topics Generated by LDA Topic Modeling").style("font-size","15px");

//Step 2: draw the over time graph 1
// set the dimensions and margins of the graph
var margin = {top: 30, right: 50, bottom: 40, left: 100},
    width = 960 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;

// set the ranges
var x = d3.scaleTime().range([0, width]);
var y0 = d3.scaleLinear().range([height, 0]);
var y1 = d3.scaleLinear().range([height, 0]);

// define the 1st line
var valueline = d3.line()
    .x(function(d) { return x(d.date); })
    .y(function(d) { return y0(d.total_valid); });

// define the 2nd line
var valueline2 = d3.line()
    .x(function(d) { return x(d.date); })
    .y(function(d) { return y1(d.CA_wildfire); });

// append the svg obgect to the body of the page
// appends a 'group' element to 'svg'
// moves the 'group' element to the top left margin
//var svg = d3.select("body").append("svg")
var svg = d3.select("#total_over_time")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
    .style("position","absolute")
    .append("g")
    .attr("transform",
          "translate(" + margin.left + "," + margin.top + ")");
//d3.select("tooltip").append("svg")
//build tooltip
var div = d3.select("body")
            .append("div")
            .attr("class","tooltip")
            .attr("opacity", 0);

// Get the data
d3.csv("CAtweets.csv", function(error, data) {
  if (error) throw error;
  // format the data
  data.forEach(function(d) {
      //the format of time
      d.date = d3.timeParse("%d-%b-%y")(d.date);
      d.total_valid = +d.total_valid;
      d.CA_wildfire = +d.CA_wildfire;
      d.rescue = +d.rescue;
      d.CA_based = +d.CA_based;
      d.Other_loc = +d.Other_loc;
  });

  console.log(data);

  // Scale the range of the data
  x.domain(d3.extent(data, function(d) { return d.date; }));
  y0.domain([0, 2000000]);
  y1.domain([0, 5000]);

  //Add the title
  svg.append("text")
     .text("CA Wildfire Tweets: Year 2018")
     .style("font-size","20px")
     .attr("transform", "translate(" + width/3 + ", 0 )");

  // Add the valueline path.
  svg.append("path")
      .data([data])
      .attr("class", "line")
      .style("stroke","#4B999F")
      .attr("d", valueline)
  		.on("mouseover", mouseover)
  		.on("mouseout", mouseout);

  // Add the valueline2 path.
  svg.append("path")
      .data([data])
      .attr("class", "line")
      .style("stroke", "#D2691E")
      .attr("d", valueline2)
      .on("mouseover", mouseover)
  		.on("mouseout", mouseout);

  // Add the X Axis
  svg.append("g")
      .attr("transform", "translate(0," + height + ")")
      .call(d3.axisBottom(x)
      .tickFormat(d3.timeFormat('%m-%d')).ticks(data.length))
      .style("opacity","0.8");

  // Add the Y0 Axis
  svg.append("g")
      .attr("class", "axisSteelBlue")
      .call(d3.axisLeft(y0))
      .append("text")
      .text("Total Tweets collected")
      //.attr("transform","rotate(-90)")
      .style("font-size","12px")
      .style("text-anchor","start");

  // Add the Y1 Axis
  svg.append("g")
      .attr("class", "axisOrange")
      .attr("transform", "translate( " + width + ", 0 )")
      .call(d3.axisRight(y1))
      .append("text")
      .text("CA wildfire tweets")
      .style("font-size","12px")
      .style("text-anchor","end");

  function mouseover(d) {
    var x0 = x.invert(d3.mouse(this)[0]);
    var y0 = d3.event.pageY;
    var xP = d3.event.pageX;
    var bisectDate = d3.bisector(function(d) {return d.date;}).left;
    var index = bisectDate(data, x0, 1);

    div.style('left', ((d3.event.pageX + 15) + "px")).style('top', ((d3.event.pageY + 15) + "px"));
    div.transition().duration(10).style("opacity","1.2").style("font-size" ,"12px");
    div.style("stroke","lightgrey").html(function(d){
      if (y0 > 300){
        return data[index-1].CA_wildfire;
      }
      if (y0 < 300){
        return data[index-1].total_valid;
      }
    });
    paused = true;
  }

  function mouseout(d) {
    div.transition().duration(10).style("opacity", 0);
    paused = false;
  }

  var margin2 = {top: 20, right: 30, bottom: 30, left: 50},
    width2 = 900 - margin2.left - margin2.right;
    height2 = 500 - margin2.top - margin2.bottom;
  var legendGap = 25;
 //Step 3: draw a second grph
  var svg2 = d3.select("#graph2")
      .append("svg")
      .attr("width", width2 + margin2.left + margin2.right)
      .attr("height", height2 + margin2.top + margin2.bottom)
      .style("position","absolute")
      .attr("transform", "translate(" + margin2.left + "," + margin2.top + ")")
      .append("g")
      .attr("transform","translate("+ margin2.left + "," + margin2.top + ")");

  // set the ranges
  var x2 = d3.scaleTime().range([0, width2]);
  var y2 = d3.scaleLinear().range([height2, 0]);

  // define the 1st line
  var valueline_graph2_res = d3.line()
          .x(function(d) { return x(d.date); })
          .y(function(d) { return y2(d.rescue); });

  // define the 2nd line
  var valueline_graph2_wildfire = d3.line()
          .x(function(d) { return x(d.date); })
          .y(function(d) { return y2(d.CA_wildfire); });

  //define the 3rd line
  var valueline_graph2_CAbased = d3.line()
          .x(function(d) { return x(d.date); })
          .y(function(d) { return y2(d.CA_based); });

   //define the 4th line
   var valueline_graph2_otherloc = d3.line()
          .x(function(d) { return x(d.date); })
          .y(function(d) { return y2(d.Other_loc); });

   // Scale the range of the data
  x2.domain(d3.extent(data, function(d) { return d.date; }));
  y2.domain([0,2000]);

  // Add the X Axis
  svg2.append("g")
      .attr("transform", "translate(0," + height2 + ")")
      .call(d3.axisBottom(x2).tickFormat(d3.timeFormat('%m-%d')).ticks(data.length))
      .style("opacity","0.8");

  // Add the Y Axis
  svg2.append("g")
      .attr("class", "axisRegular")
      .call(d3.axisLeft(y2));

  //Add legends
  svg2.append("rect")
      .attr("height",5)
      .attr("width", legendGap)
      .attr("fill","green")
      .attr("transform","translate("+ legendGap + ",0)");

  svg2.append("text").text("CA Wildfire Tweets")
      .style("font-size", "13px")
      .attr("transform", "translate(" + 2*legendGap + ",3)")
      .on("click", function(d){
        currentOpa = d3.select(".wildfire").style("opacity");
        d3.select(".wildfire").transition()
          .style("opacity", currentOpa == 1? 0:1)
      });

  svg2.append("rect")
      .attr("height",5)
      .attr("width", legendGap)
      .attr("fill","red")
      .attr("transform","translate("+ 8*legendGap + ",0)");

  svg2.append("text").text("Those Located in CA")
      .style("font-size", "13px")
      .attr("transform", "translate(" + 9*legendGap + ",3)")
      .on("click", function(d){
        currentOpa = d3.select(".CAbased").style("opacity");
        d3.select(".CAbased").transition()
            .style("opacity", currentOpa == 1? 0:1)
      });

  svg2.append("rect")
      .attr("height",5)
      .attr("width", legendGap)
      .attr("fill","purple")
      .attr("transform","translate("+ 16*legendGap + ",0)");

  svg2.append("text").text("Other than CA")
      .style("font-size", "13px")
      .attr("transform", "translate(" + 17*legendGap + ",3)")
      .on("click", function(d){
        currentOpa = d3.select(".otherLoc").style("opacity");
        d3.select(".otherLoc").transition()
          .style("opacity", currentOpa == 1? 0:1)
        });

  svg2.append("rect")
      .attr("height",5)
      .attr("width", legendGap)
      .attr("fill","#4B999F")
      .attr("transform","translate("+ 8*legendGap + ",20)");

  svg2.append("text").text("Those are Rescue-related")
      .style("font-size", "13px")
      .attr("transform", "translate(" + 9*legendGap + ",23)")
      .on("click", function(d){
          currentOpa = d3.select(".res").style("opacity");
          d3.select(".res").transition()
            .style("opacity", currentOpa == 1? 0:1)
        });

    //Add the valueline_graph2_res path
  svg2.append("path")
        .data([data])
        .attr("class","line res")
        .style("stroke","#4B999F")
        .style("opacity",0)
        .attr("d", valueline_graph2_res)
        .on("mouseover",drawToolTip)
        .on("mouseout",removeToolTip);

  svg2.append("path")
        .data([data])
        .attr("class","line otherLoc")
        .style("stroke","purple")
        .style("opacity",0)
        .attr("d", valueline_graph2_otherloc)
        .on("mouseover",drawToolTip)
        .on("mouseout",removeToolTip);

  svg2.append("path")
        .data([data])
        .attr("class","line CAbased")
        .style("stroke","red")
        .style("opacity",0)
        .attr("d", valueline_graph2_CAbased)
        .on("mouseover",drawToolTip)
        .on("mouseout",removeToolTip);

  svg2.append("path")
        .data([data])
        .attr("class","line wildfire")
        .style("stroke","green")
        .style("opacity",0)
        .attr("d", valueline_graph2_wildfire)
        .on("mouseover",drawToolTip)
        .on("mouseout",removeToolTip);

var tipBox = d3.select("body").append("graph2")
        .attr("class","tooltip")
        .attr("opacity", 1);

//when mouse is on one of the lines, it will show all the coorespond vaues
//of all lines that are shown on the graph
function drawToolTip(d){
  var x20 = x.invert(d3.mouse(this)[0]);
  // var y20 = d3.event.pageY;
  // var x2P = d3.event.pageX;
  var bisectDate = d3.bisector(function(d) {return d.date;}).left;
  var index = bisectDate(data, x20, 1);

  var wd_op = d3.select(".wildfire").style("opacity");
  var res_op = d3.select(".res").style("opacity");
  var ca_op = d3.select(".CAbased").style("opacity");
  var other_op = d3.select(".otherLoc").style("opacity");

  tipBox.style('left', ((d3.event.pageX + 25) + "px"))
         .style('top', ((d3.event.pageY + 15) + "px"));

  tipBox.transition()
        .duration(10)
        .style("opacity","1.0")
        .style("font-size" ,"14px");

  tipBox.style("stroke","black").html(function(d){
      var tool_wildfire = "<br>",
      tool_CA = "<br>",
      tool_other ="<br>",
      tool_res = "<br>";
      //assign the values based on whether the line is drawn
      if (wd_op == 1){
         tool_wildfire = "Total: " + data[index-1].CA_wildfire + "<br>"; }
      if (res_op == 1){
        tool_res = "Rescue: " + data[index-1].rescue + "<br>";}
      if (ca_op == 1){
        tool_CA = "Loc in CA: " + data[index-1].CA_based + "<br>"; }
      if (other_op == 1){
        tool_other = "Other Loc: " + data[index-1].Other_loc + "<br>"; }

      return tool_wildfire + tool_CA + tool_other + tool_res;
  });
  paused = true;
}
//the values disappear when the mouse is out
function removeToolTip(d){
  tipBox.transition().duration(10).style("opacity", 0);
  paused = false;
}

});

</script><div class="tooltip" opacity="0"></div>

<graph2 class="tooltip" opacity="1"></graph2></body></html>